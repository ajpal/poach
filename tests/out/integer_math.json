[{"program_text":"(datatype Math\n    (Diff Math Math)\n    (Integral Math Math)\n    \n    (Add Math Math)\n    (Sub Math Math)\n    (Mul Math Math)\n    (Div Math Math)\n    (Pow Math Math)\n    (RShift Math Math)\n    (LShift Math Math)\n    (Mod Math Math)\n    (Not Math)\n    \n    (Const i64)\n    (Var String))\n\n(relation MathU (Math))\n(rule ((= e (Diff x y))) ((MathU e)))\n(rule ((= e (Integral x y))) ((MathU e)))\n(rule ((= e (Add x y))) ((MathU e)))\n(rule ((= e (Sub x y))) ((MathU e)))\n(rule ((= e (Mul x y))) ((MathU e)))\n(rule ((= e (Div x y))) ((MathU e)))\n(rule ((= e (Pow x y))) ((MathU e)))\n(rule ((= e (Const x))) ((MathU e)))\n(rule ((= e (Var x))) ((MathU e)))\n(rule ((= e (RShift x y))) ((MathU e)))\n(rule ((= e (LShift x y))) ((MathU e)))\n(rule ((= e (Mod x y))) ((MathU e)))\n(rule ((= e (Not x))) ((MathU e)))\n\n(relation evals-to (Math i64))\n(rule ((evals-to x vx)) ((union x (Const vx))))\n(rule ((= e (Const c))) ((evals-to e c)))\n\n(relation is-not-zero (Math))\n(rule ((MathU a) (!= a (Const 0))) ((is-not-zero a)))\n\n;; Evaluation\n(rewrite (Add (Const a) (Const b))\n         (Const (+ a b)))\n(rewrite (Sub (Const a) (Const b))\n            (Const (- a b)))\n(rewrite (Mul (Const a) (Const b)) (Const (* a b)))\n(rewrite (Div (Const a) (Const b)) (Const (/ a b)) :when ((!= 0 b)))\n(rewrite (RShift (Const a) (Const b)) (Const (>> a b)))\n(rewrite (LShift (Const a) (Const b)) (Const (<< a b)))\n(rewrite (Not (Const a)) (Const (not-i64 a)))\n\n;; Properties\n(rewrite (Add a b) (Add b a))\n(rewrite (Mul a b) (Mul b a))\n(rewrite (Add a (Add b c)) (Add (Add a b) c))\n(rewrite (Mul a (Mul b c)) (Mul (Mul a b) c))\n\n(rewrite (Sub a b) (Add a (Mul (Const -1) b)))\n\n(rewrite (Add a (Const 0)) a)\n(rewrite (Mul a (Const 0)) (Const 0))\n(rewrite (Mul a (Const 1)) a)\n\n(rule ((MathU a) (!= a (Const 0))) ((union a (Add a (Const 0)))))\n(rule ((MathU a) (!= a (Const 1))) ((union a (Mul a (Const 1)))))\n\n(rewrite (Sub a a) (Const 0))\n(rewrite (Div a a) (Const 1) :when ((is-not-zero a)))\n\n(rewrite (Mul a (Add b c)) (Add (Mul a b) (Mul a c)))\n(rewrite (Add (Mul a b) (Mul a c)) (Mul a (Add b c)))\n\n; This rule doesn't work when pow is negative - consider 2^-1 * 2^1, which is 0, but 2^0 = 1\n(rewrite (Mul (Pow a b) (Pow a c)) (Pow a (Add b c)) :when ((is-not-zero b) (is-not-zero c)))\n\n(rewrite (Pow x (Const 0)) (Const 1) :when ((is-not-zero x)))\n(rewrite (Pow x (Const 1 )) x)\n(rewrite (Pow x (Const 2)) (Mul x x))\n\n(rewrite (Pow x (Const -1)) (Div (Const 1) x) :when ((is-not-zero x)))\n\n(rewrite (Mul x (Pow (Const 2) y)) (LShift x y))\n(rewrite (Div x (Pow (Const 2) y)) (RShift x y))\n\n(rewrite (Not (Not x)) x)\n\n\n;; Tests\n(let start-expr (Div (\n                        Mul (Var \"a\") (Pow (Const 2) (Const 3))\n                    ) (\n                        Add (Var \"c\") (\n                            Sub (Mul (Var \"b\") (Const 2)) (Mul (Var \"b\") (Const 2))\n                        )\n                    )))\n\n(let equiv-expr (Div (\n                    LShift (Var \"a\") (Const 3)\n                ) (\n                    Mul (Var \"c\") (Not (Not (Const 1)))\n                )\n                ))\n\n(run 4)\n\n(check (= start-expr equiv-expr))\n\n","evts":[{"sexp_idx":0,"evt":"start","time":{"secs":0,"nanos":1813366}},{"sexp_idx":0,"evt":"end","time":{"secs":0,"nanos":3214104}},{"sexp_idx":1,"evt":"start","time":{"secs":0,"nanos":3214435}},{"sexp_idx":1,"evt":"end","time":{"secs":0,"nanos":3338184}},{"sexp_idx":2,"evt":"start","time":{"secs":0,"nanos":3338450}},{"sexp_idx":2,"evt":"end","time":{"secs":0,"nanos":3671220}},{"sexp_idx":3,"evt":"start","time":{"secs":0,"nanos":3671531}},{"sexp_idx":3,"evt":"end","time":{"secs":0,"nanos":3863778}},{"sexp_idx":4,"evt":"start","time":{"secs":0,"nanos":3864013}},{"sexp_idx":4,"evt":"end","time":{"secs":0,"nanos":4042419}},{"sexp_idx":5,"evt":"start","time":{"secs":0,"nanos":4042689}},{"sexp_idx":5,"evt":"end","time":{"secs":0,"nanos":4219497}},{"sexp_idx":6,"evt":"start","time":{"secs":0,"nanos":4219771}},{"sexp_idx":6,"evt":"end","time":{"secs":0,"nanos":4389354}},{"sexp_idx":7,"evt":"start","time":{"secs":0,"nanos":4389586}},{"sexp_idx":7,"evt":"end","time":{"secs":0,"nanos":4618063}},{"sexp_idx":8,"evt":"start","time":{"secs":0,"nanos":4618389}},{"sexp_idx":8,"evt":"end","time":{"secs":0,"nanos":4844505}},{"sexp_idx":9,"evt":"start","time":{"secs":0,"nanos":4844780}},{"sexp_idx":9,"evt":"end","time":{"secs":0,"nanos":5015001}},{"sexp_idx":10,"evt":"start","time":{"secs":0,"nanos":5015428}},{"sexp_idx":10,"evt":"end","time":{"secs":0,"nanos":5180358}},{"sexp_idx":11,"evt":"start","time":{"secs":0,"nanos":5180629}},{"sexp_idx":11,"evt":"end","time":{"secs":0,"nanos":5353457}},{"sexp_idx":12,"evt":"start","time":{"secs":0,"nanos":5353721}},{"sexp_idx":12,"evt":"end","time":{"secs":0,"nanos":5528871}},{"sexp_idx":13,"evt":"start","time":{"secs":0,"nanos":5529190}},{"sexp_idx":13,"evt":"end","time":{"secs":0,"nanos":5702232}},{"sexp_idx":14,"evt":"start","time":{"secs":0,"nanos":5702529}},{"sexp_idx":14,"evt":"end","time":{"secs":0,"nanos":5864149}},{"sexp_idx":15,"evt":"start","time":{"secs":0,"nanos":5864417}},{"sexp_idx":15,"evt":"end","time":{"secs":0,"nanos":6057850}},{"sexp_idx":16,"evt":"start","time":{"secs":0,"nanos":6058154}},{"sexp_idx":16,"evt":"end","time":{"secs":0,"nanos":6299352}},{"sexp_idx":17,"evt":"start","time":{"secs":0,"nanos":6299634}},{"sexp_idx":17,"evt":"end","time":{"secs":0,"nanos":6587521}},{"sexp_idx":18,"evt":"start","time":{"secs":0,"nanos":6587934}},{"sexp_idx":18,"evt":"end","time":{"secs":0,"nanos":6779598}},{"sexp_idx":19,"evt":"start","time":{"secs":0,"nanos":6779766}},{"sexp_idx":19,"evt":"end","time":{"secs":0,"nanos":7290858}},{"sexp_idx":20,"evt":"start","time":{"secs":0,"nanos":7291265}},{"sexp_idx":20,"evt":"end","time":{"secs":0,"nanos":7805494}},{"sexp_idx":21,"evt":"start","time":{"secs":0,"nanos":7805946}},{"sexp_idx":21,"evt":"end","time":{"secs":0,"nanos":8229946}},{"sexp_idx":22,"evt":"start","time":{"secs":0,"nanos":8230373}},{"sexp_idx":22,"evt":"end","time":{"secs":0,"nanos":8741552}},{"sexp_idx":23,"evt":"start","time":{"secs":0,"nanos":8742067}},{"sexp_idx":23,"evt":"end","time":{"secs":0,"nanos":9452377}},{"sexp_idx":24,"evt":"start","time":{"secs":0,"nanos":9452869}},{"sexp_idx":24,"evt":"end","time":{"secs":0,"nanos":9884450}},{"sexp_idx":25,"evt":"start","time":{"secs":0,"nanos":9884898}},{"sexp_idx":25,"evt":"end","time":{"secs":0,"nanos":10317397}},{"sexp_idx":26,"evt":"start","time":{"secs":0,"nanos":10317847}},{"sexp_idx":26,"evt":"end","time":{"secs":0,"nanos":10754929}},{"sexp_idx":27,"evt":"start","time":{"secs":0,"nanos":10755368}},{"sexp_idx":27,"evt":"end","time":{"secs":0,"nanos":11226202}},{"sexp_idx":28,"evt":"start","time":{"secs":0,"nanos":11226642}},{"sexp_idx":28,"evt":"end","time":{"secs":0,"nanos":11529699}},{"sexp_idx":29,"evt":"start","time":{"secs":0,"nanos":11530087}},{"sexp_idx":29,"evt":"end","time":{"secs":0,"nanos":11924031}},{"sexp_idx":30,"evt":"start","time":{"secs":0,"nanos":11924425}},{"sexp_idx":30,"evt":"end","time":{"secs":0,"nanos":12322215}},{"sexp_idx":31,"evt":"start","time":{"secs":0,"nanos":12322673}},{"sexp_idx":31,"evt":"end","time":{"secs":0,"nanos":12930345}},{"sexp_idx":32,"evt":"start","time":{"secs":0,"nanos":12930836}},{"sexp_idx":32,"evt":"end","time":{"secs":0,"nanos":13459579}},{"sexp_idx":33,"evt":"start","time":{"secs":0,"nanos":13460122}},{"sexp_idx":33,"evt":"end","time":{"secs":0,"nanos":13837479}},{"sexp_idx":34,"evt":"start","time":{"secs":0,"nanos":13837852}},{"sexp_idx":34,"evt":"end","time":{"secs":0,"nanos":14166205}},{"sexp_idx":35,"evt":"start","time":{"secs":0,"nanos":14166600}},{"sexp_idx":35,"evt":"end","time":{"secs":0,"nanos":14881492}},{"sexp_idx":36,"evt":"start","time":{"secs":0,"nanos":14881939}},{"sexp_idx":36,"evt":"end","time":{"secs":0,"nanos":15515340}},{"sexp_idx":37,"evt":"start","time":{"secs":0,"nanos":15515700}},{"sexp_idx":37,"evt":"end","time":{"secs":0,"nanos":15804688}},{"sexp_idx":38,"evt":"start","time":{"secs":0,"nanos":15805025}},{"sexp_idx":38,"evt":"end","time":{"secs":0,"nanos":16119462}},{"sexp_idx":39,"evt":"start","time":{"secs":0,"nanos":16119808}},{"sexp_idx":39,"evt":"end","time":{"secs":0,"nanos":16556248}},{"sexp_idx":40,"evt":"start","time":{"secs":0,"nanos":16556668}},{"sexp_idx":40,"evt":"end","time":{"secs":0,"nanos":17124885}},{"sexp_idx":41,"evt":"start","time":{"secs":0,"nanos":17125332}},{"sexp_idx":41,"evt":"end","time":{"secs":0,"nanos":17670030}},{"sexp_idx":42,"evt":"start","time":{"secs":0,"nanos":17670431}},{"sexp_idx":42,"evt":"end","time":{"secs":0,"nanos":18022586}},{"sexp_idx":43,"evt":"start","time":{"secs":0,"nanos":18023276}},{"sexp_idx":43,"evt":"end","time":{"secs":0,"nanos":18270317}},{"sexp_idx":44,"evt":"start","time":{"secs":0,"nanos":18270623}},{"sexp_idx":44,"evt":"end","time":{"secs":0,"nanos":18532298}},{"sexp_idx":45,"evt":"start","time":{"secs":0,"nanos":18532606}},{"sexp_idx":45,"evt":"end","time":{"secs":0,"nanos":19003502}},{"sexp_idx":46,"evt":"start","time":{"secs":0,"nanos":19003889}},{"sexp_idx":46,"evt":"end","time":{"secs":0,"nanos":19417415}},{"sexp_idx":47,"evt":"start","time":{"secs":0,"nanos":19417791}},{"sexp_idx":47,"evt":"end","time":{"secs":0,"nanos":19740098}},{"sexp_idx":48,"evt":"start","time":{"secs":0,"nanos":19740432}},{"sexp_idx":48,"evt":"end","time":{"secs":0,"nanos":19946283}},{"sexp_idx":49,"evt":"start","time":{"secs":0,"nanos":19946574}},{"sexp_idx":49,"evt":"end","time":{"secs":0,"nanos":23302532}},{"sexp_idx":50,"evt":"start","time":{"secs":0,"nanos":23302870}},{"sexp_idx":50,"evt":"end","time":{"secs":0,"nanos":25756433}},{"sexp_idx":51,"evt":"start","time":{"secs":0,"nanos":25756726}},{"sexp_idx":51,"evt":"end","time":{"secs":0,"nanos":73816703}},{"sexp_idx":52,"evt":"start","time":{"secs":0,"nanos":73817331}},{"sexp_idx":52,"evt":"end","time":{"secs":0,"nanos":74481459}}]}]